# Test directory
set(TESTS_ROOT_DIR "${CMAKE_SOURCE_DIR}/tests")
set(TESTS_SCRIPTS_DIR "${TESTS_ROOT_DIR}/scripts")
# Script to compare tests' stdout output
set(TEST_DIFF_STDOUT "${TESTS_SCRIPTS_DIR}/diff_stdout.py")

# Generate tests scripts
configure_file(squish_run.sh.cmake squish_run.sh @ONLY)
configure_file(squish_ide.sh.cmake squish_ide.sh @ONLY)

# Generate statistic script
if(STAT_RUN)
  execute_process(COMMAND realpath ${STAT_RUN} OUTPUT_VARIABLE STAT_RUN)
  string(REGEX REPLACE "(\r?\n)+$" "" STAT_RUN ${STAT_RUN})
  configure_file(stat_run.sh.cmake stat_run.sh @ONLY)
  message(STATUS "STAT_RUN='" ${STAT_RUN} "'")
else(STAT_RUN)
  file(REMOVE stat_run.sh)
endif(STAT_RUN)

# Check that the test files are at the good revision
execute_process(COMMAND /bin/bash -c "\"${CMAKE_SOURCE_DIR}/tests/check-files-svn-rev.sh\" \"${TESTS_FILES_DIR}\" \"${CMAKE_SOURCE_DIR}/tests/files-svn-rev\"" RESULT_VARIABLE TEST_FILES_OK)
if(NOT TEST_FILES_OK EQUAL 0)
	message(WARNING "Tests files aren't valid. You are likely to see lots of failing test cases.. !")
endif()
