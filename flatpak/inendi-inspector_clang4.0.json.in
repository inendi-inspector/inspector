{
  "app-id": "com.esi_inendi.Inspector",
  "branch": "master",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "1.6",
  "sdk": "org.freedesktop.Sdk",
  "sdk-extensions": [ "org.freedesktop.Sdk.Extension.gcc7" ],
  "command": "inspector_launcher.sh",
  "rename-desktop-file" : "inendi-inspector.desktop",
  "rename-icon" : "inendi-inspector",
  "cleanup-commands": [
    "rm -rf /app/include /app/etc /app/sbin/ /app/lib/*.a /app/lib/*.la /app/lib/debug /app/examples /app/doc /app/mkspecs",
    "cd /app/share && ls -I inendi -I pocl -I doc -I applications -I icons | xargs rm -rf",
    "cd /app/share/applications && ls -I inendi-inspector.desktop | xargs rm -rf",
    "cd /app/share/doc && ls -I inendi-inspector | xargs rm -rf",
    "cd /app/lib && find . -maxdepth 1 -type d -not -name . -not -name inendi-inspector -not -name clang -exec rm -rf {} +",
    "cd /app/bin && ls -I run_cmd.sh -I inspector_launcher.sh -I inendi-inspector -I inendi-logstats -I inendi-echoid -I inendi-lsinit -I ld -I lld -I ld.lld -I clang-4.0 -I clang -I clang++ -I pwgen -I tshark -I lbzip2 -I lbunzip2 -I pigz -I unpigz |xargs rm -rf",
    "cp /usr/lib/libbfd-2.27.0.20160806.so /usr/lib/crtn.o /usr/lib/crti.o /usr/lib/libmvec_nonshared.a /usr/lib/x86_64-unknown-linux/6.2.0/libgcc.a /usr/lib/x86_64-unknown-linux/6.2.0/crtbeginS.o /usr/lib/x86_64-unknown-linux/6.2.0/crtendS.o /app/lib",
    "ln -s /usr/lib/libc.so.6 /app/lib/libc.so && cp /usr/lib/sdk/gcc7/lib/libgcc_s.so.1 /app/lib && ln -s /app/lib/libgcc_s.so.1 /app/lib/libgcc_s.so && cp /usr/lib/sdk/gcc7/lib/libstdc++.so.6 /app/lib && ln -s /app/lib/libstdc++.so.6 /app/lib/libstdc++.so"
  ],
  "finish-args": [
    "--socket=x11",
    "--socket=wayland",
    "--share=network",
    "--filesystem=host",
    "--nofilesystem=~/.wireshark/geoip_db_paths",
    "--device=all"
  ],
  "modules": [
    {
      "name": "boost",
      "buildsystem": "autotools",
      "sources": [
        {
          "type": "archive",
          "url": "https://sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.bz2",
          "sha256": "727a932322d94287b62abb1bd2d41723eec4356a7728909e38adb65ca25241ca"
        },
        {
          "type": "file",
          "path": "boost-configure",
          "dest-filename": "configure"
        }
      ]
    },
    {
      "name":"mysql",
      "buildsystem": "cmake",
      "config-opts": [
        "-DWITHOUT_SERVER=ON",
        "-DWITH_UNIT_TESTS=OFF"
      ],
      "builddir": true,
      "sources": [
        {
          "type": "archive",
          "url": "http://http.debian.net/debian/pool/main/m/mysql-5.7/mysql-5.7_5.7.21.orig.tar.gz",
          "sha256": "ad29ecb6fb3c3571394fe231633a2d1d188d49e9eb749daa4e8799b7630daa09"
        },
        {
          "type": "shell",
          "commands": [ "sed -i '642d' CMakeLists.txt", "# Fix serverless build, see https://bugs.mysql.com/bug.php?id=87348" ]
        }
      ]
    },
    {
      "name": "qt5-inendi",
      "config-opts": [
        "-opensource",
        "-confirm-license",
        "-qt-sql-mysql"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://http.debian.net/debian/pool/main/q/qtbase-opensource-src/qtbase-opensource-src_5.3.2+dfsg.orig.tar.xz",
          "sha256": "0e68ab39c4b9ef858c9de3167627668d4ecd8c222600feac2f4939e72f9816fe"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/fix_bug_in_internal_comparison_operator.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/fix_imagehandlers_cves.diff"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/fix_sparc_atomics.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/gnukfreebsd.diff"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/hurd_opengl_incldir.diff"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/mips_more_pre-mips32.diff"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/networkconfig_prevent_bad_deref.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/remove_google_adsense.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/remove_icon_from_example.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/revert_upstream_bsymbolic_change.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/debian/xcb_delay_showing_tray_icon_window_until_it_is_embedded.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/inendi/0001-Fix-rectangle-intersection-issue-because-of-floating.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/inendi/0002-Permit-to-specify-a-default-QTransform-in-QGraphisSc.patch"
        },
        {
          "type": "patch",
          "path": "qt5.3.2_patches/inendi/0003-Add-qint64-based-QScrollBar-class-aka-QScrollBar64.patch"
        },
        {
          "type": "file",
          "path": "qt5.3.2_patches/inendi/qabstractslider64.h",
          "dest-filename": "include/QtWidgets/qabstractslider64.h"
        },
        {
          "type": "file",
          "path": "qt5.3.2_patches/inendi/qscrollbar64.h",
          "dest-filename": "include/QtWidgets/qscrollbar64.h"
        },
        {
          "type": "file",
          "path": "qt5.3.2_patches/inendi/QAbstractSlider64",
          "dest-filename": "include/QtWidgets/QAbstractSlider64"
        },
        {
          "type": "file",
          "path": "qt5.3.2_patches/inendi/QScrollBar64",
          "dest-filename": "include/QtWidgets/QScrollBar64"
        }
      ]
    },
    {
      "name": "qtwebkit5",
      "sources": [
        {
          "type": "archive",
          "url": "http://http.debian.net/debian/pool/main/q/qtwebkit-opensource-src/qtwebkit-opensource-src_5.3.2+dfsg.orig.tar.xz",
          "sha256": "138b39a4fb77c61e30ff28bc07726bd5a7bd54030169c51539854ae2665c7497"
        },
        {
          "type": "file",
          "path": "webkit-configure",
          "dest-filename": "configure"
        },
        {
          "type": "patch",
          "path": "webkit_5.3.2_patches/fix_gcc5_compile.patch"
        },
        {
          "type": "patch",
          "path": "webkit_5.3.2_patches/glibc_2.43.patch"
        }
      ]
    },
    {
      "name": "gtest",
      "buildsystem": "cmake",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/google/googletest/archive/release-1.8.0.tar.gz",
          "sha256": "58a6f4277ca2bc8565222b3bbd58a177609e9c488e8a72649359ba51450db7d8"
        }
      ]
    },
    {
      "name": "libgpgerror",
      "sources": [
        {
          "type": "archive",
          "url": "https://www.gnupg.org/ftp/gcrypt/libgpg-error/libgpg-error-1.27.tar.bz2",
          "sha256": "4f93aac6fecb7da2b92871bb9ee33032be6a87b174f54abf8ddf0911a22d29d2"
        }
      ]
    },
    {
      "name": "libgcrypt",
      "sources": [
        {
          "type": "archive",
          "url": "https://www.gnupg.org/ftp/gcrypt/libgcrypt/libgcrypt-1.8.2.tar.bz2",
          "sha256": "c8064cae7558144b13ef0eb87093412380efa16c4ee30ad12ecb54886a524c07"
        }
      ]
    },
    {
      "name": "pigz",
      "sources": [
        {
          "type": "archive",
          "url": "https://zlib.net/pigz/pigz-2.4.tar.gz",
          "sha256": "a4f816222a7b4269bd232680590b579ccc72591f1bb5adafcd7208ca77e14f73"
        },
        {
          "type": "file",
          "path": "pigz-configure",
          "dest-filename": "configure"
        }
      ]
    },
    {
      "name": "lbzip2",
      "sources": [
        {
          "type": "archive",
          "url": "http://archive.lbzip2.org/lbzip2-2.5.tar.bz2",
          "sha256": "eec4ff08376090494fa3710649b73e5412c3687b4b9b758c93f73aa7be27555b"
        }
      ]
    },
    {
      "name": "gperftools",
      "config-opts": [
        "--enable-minimal"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/gperftools/gperftools/archive/gperftools-2.6.3.tar.gz",
          "sha256": "0c067fbef016daea0ff5c73135444624bf6efa89662c1537e54dad7a2b037c1b"
        }
      ]
    },
    {
      "name": "libhwloc",
      "sources": [
        {
          "type": "archive",
          "url": "https://www.open-mpi.org/software/hwloc/v1.11/downloads/hwloc-1.11.8.tar.bz2",
          "sha256": "ecef10265084d9123dc0b03d82ff5ee06fbf5ba755a912e7511ae590c9ee594d"
        }
      ]
    },
    {
      "name": "pwgen",
      "sources": [
        {
          "type": "archive",
          "url": "http://http.debian.net/debian/pool/main/p/pwgen/pwgen_2.07.orig.tar.gz",
          "sha256": "eb74593f58296c21c71cd07933e070492e9222b79cedf81d1a02ce09c0e11556"
        }
      ]
    },
    {
      "name": "mm-common",
      "config-opts": [
        "--disable-documentation"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://download.gnome.org/sources/mm-common/0.9/mm-common-0.9.10.tar.xz",
          "sha256": "16c0e2bc196b67fbc145edaecb5dbe5818386504fe5703de27002d77140fa217"
        }
      ]
    },
    {
      "name": "libsigcplusplus",
      "config-opts": [
        "--disable-documentation"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://download.gnome.org/sources/libsigc++/2.10/libsigc++-2.10.0.tar.xz",
          "sha256": "f843d6346260bfcb4426259e314512b99e296e8ca241d771d21ac64f28298d81"
        }
      ]
    },
    {
      "name": "rapidjson",
      "buildsystem": "cmake",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/Tencent/rapidjson/archive/v1.1.0.tar.gz",
          "sha256": "bf7ced29704a1e696fbccf2a2b4ea068e7774fa37f6d7dd4039d0787f8bed98e"
        }
      ]
    },
    {
      "name": "libnuma",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/numactl/numactl/archive/v2.0.11.tar.gz",
          "sha256": "3e099a59b2c527bcdbddd34e1952ca87462d2cef4c93da9b0bc03f02903f7089"
        }
      ]
    },
    {
      "name": "asciidoc",
      "sources": [
        {
          "type": "archive",
          "url": "https://sourceforge.net/projects/asciidoc/files/asciidoc/8.6.9/asciidoc-8.6.9.tar.gz",
          "sha256": "78db9d0567c8ab6570a6eff7ffdf84eadd91f2dfc0a92a2d0105d323cab4e1f0"
        }
      ]
    },
    {
      "name": "breakpad",
      "builddir": true,
      "subdir": "breakpad/src",
      "build-options": {
        "build-args": [
          "--share=network"
        ]
      },
      "sources": [
        {
          "type": "git",
          "url": "https://chromium.googlesource.com/chromium/tools/depot_tools.git",
          "commit": "da669d61230a10f71a13703889a97827db35ffd9"
        },
        {
          "type": "shell",
          "commands": [
            "mkdir breakpad && cd breakpad && ../fetch --no-history breakpad && cd src"
          ]
        }
      ]
    },
    {
      "name": "opencl",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/OCL-dev/ocl-icd/archive/v2.2.12.tar.gz",
          "sha256": "17500e5788304eef5b52dbe784cec197bdae64e05eecf38317840d2d05484272"
        }
      ]
    },
    {
      "name": "llvm",
      "buildsystem": "cmake-ninja",
      "builddir": true,
      "build-options": {
        "arch": {
          "x86_64": {
            "config-opts": [
              "-DLLVM_TARGETS_TO_BUILD=X86;NVPTX"
            ]
          }
        }
      },
      "config-opts": [
        "-GNinja",
        "-DCMAKE_C_FLAGS_RELEASE:STRING=-DNDEBUG",
        "-DCMAKE_CXX_FLAGS_RELEASE:STRING=-DNDEBUG",
        "-DBUILD_SHARED_LIBS:BOOL=ON",
        "-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON",
        "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
        "-DLLVM_LIBDIR_SUFFIX=",
        "-DLLVM_ENABLE_LIBCXX:BOOL=OFF",
        "-DLLVM_ENABLE_ZLIB:BOOL=ON",
        "-DLLVM_ENABLE_FFI:BOOL=ON",
        "-DLLVM_ENABLE_RTTI:BOOL=ON",
        "-DLLVM_BUILD_RUNTIME:BOOL=ON",
        "-DLLVM_INCLUDE_TOOLS:BOOL=ON",
        "-DLLVM_BUILD_TOOLS:BOOL=ON",
        "-DLLVM_INCLUDE_TESTS:BOOL=OFF",
        "-DLLVM_BUILD_TESTS:BOOL=OFF",
        "-DLLVM_INCLUDE_EXAMPLES:BOOL=OFF",
        "-DLLVM_BUILD_EXAMPLES:BOOL=OFF",
        "-DLLVM_INCLUDE_UTILS:BOOL=ON",
        "-DLLVM_INSTALL_UTILS:BOOL=OFF",
        "-DLLVM_INCLUDE_DOCS:BOOL=OFF",
        "-DLLVM_BUILD_DOCS:BOOL=OFF",
        "-DLLVM_ENABLE_SPHINX:BOOL=OFF",
        "-DLLVM_ENABLE_DOXYGEN:BOOL=OFF",
        "-DLLVM_BUILD_LLVM_DYLIB:BOOL=OFF",
        "-DLLVM_BUILD_EXTERNAL_COMPILER_RT:BOOL=ON",
        "-DFFI_INCLUDE_DIR=/usr/lib/libffi-3.2.1/include",
        "-DLLVM_INSTALL_TOOLCHAIN_ONLY:BOOL=OFF"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://releases.llvm.org/4.0.1/llvm-4.0.1.src.tar.xz",
          "sha256": "da783db1f82d516791179fe103c71706046561f7972b18f0049242dee6712b51"
        }
      ]
    },
    {
      "name": "clang",
      "buildsystem": "cmake-ninja",
      "builddir": true,
      "build-options": {
        "cflags": "-g1",
        "cxxflags": "-g1"
      },
      "config-opts": [
        "-GNinja",
        "-DCMAKE_C_FLAGS_RELEASE:STRING=-DNDEBUG",
        "-DCMAKE_CXX_FLAGS_RELEASE:STRING=-DNDEBUG",
        "-DBUILD_SHARED_LIBS:BOOL=ON",
        "-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON",
        "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
        "-DLLVM_CONFIG:FILEPATH=/app/bin/llvm-config",
        "-DCLANG_ENABLE_ARCMT:BOOL=ON",
        "-DCLANG_ENABLE_STATIC_ANALYZER:BOOL=ON",
        "-DCLANG_INCLUDE_DOCS:BOOL=OFF",
        "-DCLANG_INCLUDE_TESTS:BOOL=OFF",
        "-DCLANG_PLUGIN_SUPPORT:BOOL=ON",
        "-DCLANG_BUILD_EXAMPLES:BOOL=OFF"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://releases.llvm.org/4.0.1/cfe-4.0.1.src.tar.xz",
          "sha256": "61738a735852c23c3bdbe52d035488cdb2083013f384d67c1ba36fabebd8769b"
        }
      ]
    },
    {
      "name": "lld",
      "buildsystem": "cmake-ninja",
      "builddir": true,
      "config-opts": [
        "-GNinja",
        "-DCMAKE_C_FLAGS_RELEASE:STRING=-DNDEBUG",
        "-DCMAKE_CXX_FLAGS_RELEASE:STRING=-DNDEBUG",
        "-DCMAKE_BUILD_TYPE=Release",
        "-DLLVM_CONFIG:FILEPATH=/app/bin/llvm-config"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "http://releases.llvm.org/4.0.1/lld-4.0.1.src.tar.xz",
          "sha256": "63ce10e533276ca353941ce5ab5cc8e8dcd99dbdd9c4fa49f344a212f29d36ed"
        }
      ]
    },
    {
      "name": "portablecl",
      "buildsystem": "cmake",
      "config-opts": [
        "-DWITH_LLVM_CONFIG=/app/bin/llvm-config",
        "-DEXTRA_HOST_LD_FLAGS=-L/app/lib",
        "-DLINK_COMMAND=/app/bin/ld.lld",
        "-DLLC_HOST_CPU=corei7"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/pocl/pocl/archive/v1.1.tar.gz",
          "sha256": "1e8dd0693a88c84937754df947b202871a40545b1b0a97ebefa370b0281c3c53"
        }
      ]
    },
    {
      "name": "libpcap",
      "sources": [
        {
          "type": "archive",
          "url": "http://www.tcpdump.org/release/libpcap-1.8.1.tar.gz",
          "sha256": "673dbc69fdc3f5a86fb5759ab19899039a8e5e6c631749e48dcd9c6f0c83541e"
        }
      ]
    },
    {
      "name": "c-ares",
      "sources": [
        {
          "type": "archive",
          "url": "https://c-ares.haxx.se/download/c-ares-1.14.0.tar.gz",
          "sha256": "45d3c1fd29263ceec2afc8ff9cd06d5f8f889636eb4e80ce3cc7f0eaf7aadc6e"
        }
      ]
    },
    {
      "name": "tshark",
      "config-opts": [
        "--enable-wireshark=no"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://1.eu.dl.wireshark.org/src/wireshark-2.4.6.tar.xz",
          "sha256": "8e965fd282bc0c09e7c4eba5f08a555d0ccf40a7d1544b939e01b90bc893d5fe"
        }
      ]
    },
    {
      "name": "inendi-inspector-doc",
      "disabled":true,
      "build-options": {
        "env": {
          "DOCS": "documents/inendi_inspector_reference_manual",
          "INSTALLROOT": "/app/share/doc/inendi-inspector"
        }
      },
      "sources": [
        {
          "type": "git",
          "path": "../doc"
        },
        {
          "type": "file",
          "path": "no-configure",
          "dest-filename": "configure"
        }
      ]
    },
    {
      "name": "inendi-inspector",
      "buildsystem": "cmake-ninja",
      "builddir": true,
      "run-tests" : true,
      "test-rule" : "",
      "test-commands" : [ "ninja inspector_testsuite && run_cmd.sh ctest --output-on-failure --no-compress-output -T test -R INSPECTOR_TEST" ],
      "config-opts": [
        "-DCMAKE_BUILD_TYPE=@@BUILD_TYPE@@",
        "-DCMAKE_INSTALL_PREFIX=/app",
        "-DARCH_TYPE=corei7",
        "-DUSER_TARGET=@@USER_TARGET@@"
      ],
      "build-options" : {
        "env": {
            "CXX": "@@CXX_COMPILER@@"
        },
        "append-ld-library-path" : "/usr/lib/sdk/gcc7/lib",
        "test-args": [
          "--share=network",
          "--filesystem=host"
        ]
      },
      "sources": [
        {
          "type": "git",
          "path": "..",
          "branch": "@@BRANCH_NAME@@"
        }
      ],
      "post-install": [
        "ln -s /usr/lib/libm.so.6 /app/lib/libm.so",
        "cp ../flatpak/run_cmd.sh /app/bin",
        "cp ../flatpak/inspector_launcher.sh /app/bin",
        "mkdir -p /app/share/applications && cp ../flatpak/inendi-inspector.desktop /app/share/applications"
      ]
    }
  ]
}
