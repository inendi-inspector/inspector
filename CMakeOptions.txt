#
# \file CMakeOptions.txt
#
# Copyright (C) Picviz Labs 2010-2012

if (EXISTS "${CMAKE_SOURCE_DIR}/CMakeDefaultOptions.txt")
	include("${CMAKE_SOURCE_DIR}/CMakeDefaultOptions.txt")
endif()

# Default build type is debug
if (NOT DEFINED CMAKE_BUILD_TYPE)
	set(CMAKE_BUILD_TYPE "debug")
else()
if (CMAKE_BUILD_TYPE STREQUAL "")
	set(CMAKE_BUILD_TYPE "debug")
endif()
endif()
string(TOLOWER "${CMAKE_BUILD_TYPE}" CMAKE_BUILD_TYPE_LOWER)

# Arch flag
if (NOT DEFINED CMAKE_CXX_ARCH_FLAGS)
	# Guess flag from GCC. This is done so that icecc doesn't silently set all jobs as local-job !
	execute_process(COMMAND bash -c "gcc -march=native -Q --help=target | grep march |  tr -d '[[:space:]]'" OUTPUT_VARIABLE CMAKE_CXX_ARCH_FLAGS)
	#set(CMAKE_CXX_ARCH_FLAGS "-march=native")
	message(STATUS "CMAKE_CXX_ARCH_FLAGS isn't set. Flag has been guessed to ${CMAKE_CXX_ARCH_FLAGS}")
endif()

# Set default values for capabilities
if (NOT DEFINED USER_TARGET)
	set(USER_TARGET "developer")
endif()

# Default value for protection mode
if (CMAKE_BUILD_TYPE_LOWER STREQUAL "relprotect")
	set(PROTECT_PASS true)
endif()

# Parse options
if (USER_TARGET STREQUAL "developer")
	set(PICVIZ_DEVELOPER_MODE true)
	message(STATUS "Picviz mode is developer")
else()
	set(PICVIZ_DEVELOPER_MODE false)
	add_definitions(-DCUSTOMER_RELEASE)
	message(STATUS "Picviz mode is customer")
endif()

# Default value for LTO
if (NOT DEFINED USE_LTO)
	# By default, not set only in release mode
	if (CMAKE_BUILD_TYPE_LOWER STREQUAL "debug")
		set(USE_LTO false)
	else()
		set(USE_LTO true)
	endif()
endif()

declare_customer_cap(CUSTOMER_LINESNUMBER 4000000 4000000)
declare_customer_cap(CUSTOMER_CAPABILITY_SAVE 1 0)
declare_customer_cap(CUSTOMER_CAPABILITY_IMPORT_REMOTE 1 0)
declare_customer_cap(CUSTOMER_CAPABILITY_IMPORT_DB 1 0)
declare_customer_cap(CUSTOMER_CAPABILITY_IMPORT_HADOOP 1 0)

declare_customer_cap(CUSTOMER_NAME "Picviz" "user")
declare_customer_cap(CUSTOMER_COMPANY "Picviz Labs" "company")
declare_customer_cap(CUSTOMER_HARDWARE_MODEL "Proto01" "model")
declare_customer_cap(CUSTOMER_MACHINE_OS "Linux" "Linux")
declare_customer_cap(CUSTOMER_FIRST_RELEASE_VERSION "1.0.0" "1.0.0")
declare_customer_cap(CUSTOMER_FIRST_RELEASE_DATE 0 0)
declare_customer_cap(CUSTOMER_RELEASE_EXPIRATION_DATE 2147483647 0)
declare_customer_cap(CUSTOMER_CAN_UPDATE_MAJOR 1 0)
declare_customer_cap(CUSTOMER_CAN_UPDATE_MINOR 1 0)
declare_customer_cap(CUSTOMER_CAN_UPDATE_MICRO 1 1)

# Generate customer.h
set(CFG_FILE_PATH "${CMAKE_CURRENT_BINARY_DIR}/include/pvbase/customer.h")
configure_file(include/pvbase/customer.h.cmake ${CFG_FILE_PATH})
add_definitions(-DPICVIZ_CFG_FILE_PATH="${CFG_FILE_PATH}")

# Generate build.h
set(BUILD_FILE_PATH "${CMAKE_CURRENT_BINARY_DIR}/include/pvbase/build.h")
configure_file(include/pvbase/build.h.cmake ${BUILD_FILE_PATH})
add_definitions(-DPICVIZ_BUILD_FILE_PATH="${BUILD_FILE_PATH}")

